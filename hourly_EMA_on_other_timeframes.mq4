//--------------------------------------------------------------------
// userindicator.mq4 
// Предназначен для использования в качестве примера в учебнике MQL4.
//--------------------------------------------------------------------
#property indicator_chart_window    // Индик. рисуется в основном окне
#property indicator_buffers 2       // Количество буферов
#property indicator_color1 Blue     // Цвет первой линии
#property indicator_color2 Red      // Цвет второй линии

double Buf_0[],Buf_1[];             // Открытие индикаторных массивов
//--------------------------------------------------------------------
int init()                          // Специальная функция init()
  {
//--------------------------------------------------------------------
   SetIndexBuffer(0,Buf_0);         // Назначение массива буферу
   SetIndexStyle (0,DRAW_LINE,STYLE_DOT,1);// Стиль линии
//--------------------------------------------------------------------
   SetIndexBuffer(1,Buf_1);         // Назначение массива буферу
   SetIndexStyle (1,DRAW_LINE,STYLE_SOLID,1);// Стиль линии
//--------------------------------------------------------------------
   return;                          // Выход из спец. ф-ии init()
  }
//--------------------------------------------------------------------
int start()                         // Специальная функция start()
  {
   int i,                           // Индекс бара
       Counted_bars;                // Количество просчитанных баров 
//--------------------------------------------------------------------
   Counted_bars=IndicatorCounted(); // Количество просчитанных баров 
   i=Bars-Counted_bars-1;           // Индекс первого непосчитанного
   while(i>=0)                      // Цикл по непосчитанным барам
     {
      // Get index of hourly bar
      int indexInOneHourBuffer = iBarShift(NULL,PERIOD_H1, 
         iTime(NULL, 0, i));
      double emaSlow = iMA(Symbol(), PERIOD_H1, 34, // TODO : make this a parameter
         0, MODE_EMA, PRICE_CLOSE,indexInOneHourBuffer);
      double emaFast = iMA(NULL, PERIOD_H1, 8, // TODO : make this a parameter
         0, MODE_EMA, PRICE_CLOSE, indexInOneHourBuffer);         
      Buf_0[i]=emaSlow;             // Значение 0 буфера на i-ом баре
      Buf_1[i]=emaFast;              // Значение 1 буфера на i-ом баре
      i--;                          // Расчёт индекса следующего бара
     }
//--------------------------------------------------------------------
   return;                          // Выход из спец. ф-ии start()
  }
//--------------------------------------------------------------------